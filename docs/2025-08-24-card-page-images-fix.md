# Card page: корректные фото товара — 2025‑08‑24

Проблема: на странице карточки товара (`/card`) подтягивались неверные изображения (приоритет отдавался PartsIndex картинкам, которые могут не соответствовать товару).

Решение:

- Изменён приоритет источников изображений в галерее:
  - Сначала изображения из CMS/внутреннего источника (`searchProductOffers.images`).
  - Затем запасной `imageUrl` из `useArticleImage` (фолбэк).
  - И только затем — `partsIndexImages` как последний фолбэк.
- Страница карточки теперь передаёт в галерею массив `images` из результата поиска, а `partsIndexImages` не передаётся, чтобы не подменять корректные фото.
- Для `InfoCard` и JSON‑LD Product заданы те же приоритеты выбора главного изображения.

Затронутые файлы:

- `src/components/card/ProductImageGallery.tsx` — изменён порядок объединения изображений.
- `src/pages/card.tsx` — передача `images` вместо `partsIndexImages`; приоритеты для `InfoCard.image` и `schema.image`.

Тестирование:

- Проверен товар по ссылке `/card?article=L5668683&brand=BGOE` — в галерее отображаются изображения из CMS, PartsIndex не подменяет.
- Проверены случаи отсутствия CMS‑картинок — отображается фолбэк из `useArticleImage`, затем (при наличии) `partsIndexImages`.

## Фильтрация мокап‑изображения

- У многих товаров последняя картинка — общий мокап (аккумулятор). Теперь:
  - В галерее такие изображения полностью исключаются, если есть хотя бы одно реальное фото (плейсхолдеры не отображаются вовсе).
  - Если реальных фото нет, показываем плейсхолдеры (как раньше) чтобы не было пустой галереи.
  - Для основного изображения карточки (`InfoCard.image`) и JSON‑LD Product изображение отбирается первое «не мокап» из CMS; если нет, используется фолбэк, затем не‑мокап из PartsIndex.
- Признаки мокапа: подстроки в URL вида `image-10`, `noimage`, `placeholder`, `mock`, `mockup`, `akum`, `akkum`, `akku`, `accum`, `accumulator`, `battery`, `/akb` (без учёта регистра).
